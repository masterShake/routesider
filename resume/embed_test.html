<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">
  
    <style>

    #map-canvas{
        height: 500px;
        width: 500px;
    }

    </style>

  </head>
  <body>
    <h1>Hello, world!</h1>

    <div id="map-canvas"></div>

    <!-- embedable javascript maps code -->
    <script>

    // obejct literals
    var pinLits = '[{"position":{"lat":37.72945260537779,"lng":-122.47833251953125},"icon":null,"i":1},{"position":{"lat":37.78808138412046,"lng":-122.003173828125},"icon":null,"i":2},{"position":{"lat":37.37452264407724,"lng":-121.83837890625},"icon":null,"i":3}]',
        polyLits = '[{"coords":[{"lat":38.25974980039479,"lng":-122.56622314453125},{"lat":38.244651696093634,"lng":-122.10479736328125},{"lat":37.97884504049713,"lng":-122.2283935546875}],"centroid":{"lat":38.11929742044596,"lng":-122.33551025390625},"i":4,"fillColor":"#5CB85C","fillOpacity":"0.3","strokeColor":"#5CB85C","strokeOpacity":"0.8"},{"coords":[{"lat":38.23386541556983,"lng":-122.64862060546875},{"lat":37.93769926732864,"lng":-122.27508544921875},{"lat":38.004819966413194,"lng":-122.6568603515625}],"centroid":{"lat":38.08578234144923,"lng":-122.46597290039062},"i":5,"fillColor":"#5CB85C","fillOpacity":"0.3","strokeColor":"#5CB85C","strokeOpacity":"0.8"}]',
        winLits = '{"1":{"content":"<div><h4>bitches</h4><p>aint shit</p></div>","position":{"lat":37.72945260537779,"lng":-122.47833251953125}},"5":{"content":"<div><h4>holla</h4><p>if you got a dolla</p></div>","position":{"lat":38.08578234144923,"lng":-122.46597290039062}}}';

    // global variables
    var gm = 
        bounds = null,
        pins = [],
        polygons = [],
        infoWindows = {},
        pinTrigger = 
        polyTrigger = false;

    // init map on script load
    function init(){

        // init the google map
        gm = new google.maps.Map( 
            // map element
            document.getElementById("map-canvas"),
            // map options, default silicon valley
            { center: {lat: 37.65120864327176, lng: -122.091064453125}, zoom: 9 }
        );

        // init the bounds object
        bounds = new google.maps.LatLngBounds();

        // init the info windows
        initWins();

        // init the pins
        initPins();

        // init the polygons
        initPolys();
    }

    // init all the pins
    function initPins(){

        // parse the json
        pinLits = JSON.parse(pinLits);

        // loop through the pin literals
        for(var i = 0; i < pinLits.length; i++){

            // pin marker to map, push it to the 'pins' array
            pins.push( new google.maps.Marker({
                position: pinLits[i].position,
                map : gm
            }));

            // set the i property
            pins[i].set('i', pinLits[i].i);

            // extend the map bounds
            bounds.extend(pins[i].position);

            // if this pin has a cooresponding info window
            if(winLits.hasOwnProperty(pinLits[i].i))
                // add the click event
                pins[i].addListener('click', showWin);
        }

        // set the pinTrigger
        pinTrigger = true;

        // set the map bounds
        setBounds();
    }

    // init all the polygons
    function initPolys(){

        // parse the json
        polyLits = JSON.parse(polyLits);

        // loop through the polygon literals
        for(var i = 0; i < polyLits.length; i++){ console.log(polyLits[i].coords);

            // add polygon to the map, push it to the 'polys' array
            polygons.push( new google.maps.Polygon({
                paths         : latLngObjs(polyLits[i].coords),
                strokeColor   : polyLits[i].strokeColor,
                strokeOpacity : polyLits[i].strokeOpacity,
                strokeWeight  : 3,
                fillColor     : polyLits[i].fillColor,
                fillOpacity   : polyLits[i].fillOpacity,
                map           : gm
            }));

            // set the i property
            polygons[i].set('i', polyLits[i].i);

            // if this polygon has a cooresponding info window
            if(winLits.hasOwnProperty(polyLits[i].i))
                // add the click event
                polygons[i].addListener('click', showWin);
        }

        // set the pinTrigger
        polyTrigger = true;

        // set the map bounds
        setBounds();
    }

    // convert an array of LatLng literals to google maps LatLng objects
    function latLngObjs(a){

        // temp variable
        var t = null;

        // loop through the array of object literals
        for(var i = 0; i < a.length; i++){

            // create the new LatLng Object
            a[i] = new google.maps.LatLng(a[i]);

            // extend the bounds
            bounds.extend(a[i]);
        }

        // return the array
        return a;
    }

    // init the info windows
    function initWins(){

        // parse the json
        winLits = JSON.parse(winLits);

        // loop through the info window object literals
        for(var x in winLits){

            // create google maps info window objects
            infoWindows[x] = new google.maps.InfoWindow({
                content : winLits[x].content,
                position: winLits[x].position
            });
        }
    }

    // create a LatLngBounds object to set map bounds
    function setBounds(){
        // if we are done setting all the polygons and pins
        if(pinTrigger && polyTrigger)
            // set the map bounds
            gm.fitBounds(bounds);
    }

    // click event display cooresponding info window
    function showWin(){
        infoWindows[this.i].open(gm, this);
    }

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&amp;key=AIzaSyCCV74W4fbd9w1PVxD-OviILs9MPFqFdis&amp;libraries=places,drawing&amp;callback=init"></script>
    <!-- /embed code -->

  </body>
</html>